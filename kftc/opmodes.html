<!DOCTYPE html><html><head><meta charset="UTF-8"> </meta><title> OpModes | addonovan </title><meta name="viewport" content="width=device-width, initial-scale=1.0"> </meta><link rel="stylesheet" href="..//highlighting/idea.css"> </link> <script src="..//highlighting/highlight.js"></script> <style> nav { background-color: #00796B; padding-left: 5%; box-shadow: 0px 2px 5px rgba( 0, 0, 0, 0.2 ); height: 2em; z-index: 1; } nav> ul.nav { list-style: none; margin: 0; padding: 0; } nav> ul.nav> li { position: relative; display: inline; padding-top: 5px; padding-bottom: 5px; } nav> ul.nav> li.home { height: 1.7em; background: linear-gradient( 180deg, #171717, #2C2C2C, #171717 ); display: inline-block !important; padding-left: 20px; padding-right: 20px; box-shadow: 10px 0px 10px -10px rgba(0, 0, 0, 0.4), -10px 0px 10px -10px rgba(0, 0, 0, 0.4); margin-left: 1.75%; margin-right: 1.75%; } nav> ul.nav> li.home> a { color: #bf0a30; } nav> ul.nav> li.currentProject> a { color: white !important; } nav> ul.nav> li> a { text-decoration: none !important; font-size: 24px; color: rgba( 255, 255, 255, 0.87 ); transition: color 0.4s ease; font-weight: normal; } nav> ul.nav> li> a:hover { color: rgba( 255, 255, 255, 1.00 ); transition: color 0.2s ease; } @media only screen and ( max-width: 810px ) { ul.nav> li:not(.logo)> a { padding-left: 0.5%; padding-right: 0.5%; } nav { padding-left: 5%; white-space: nowrap; } } </style> <style> .wdmu.code { font-family: "Courier New", monospace !important; font-size: 14pt; background-color: #dadada; color: #5a5a5a; } .wdmu.bold { font-size: inherit; font-weight: bold; } .wdmu.italics { font-size: inherit; font-style: italic; } </style> <style> pre, pre *, pre code * { font-size: 11pt !important; font-family: "Courier", monospace !important; } </style> <style> div.withSidebar div#sidebar { float: left; margin-left: 3%; width: 19%; } div.withSidebar div#sidebar h2 { font-size: 24px; } div.withSidebar div#sidebar ul { padding-left: 15px; margin-top: 2px; } div.withSidebar div#sidebar ul li { list-style: none; margin-bottom: 2px; } div.withSidebar div#sidebar ul li ul { margin-left: 15px; margin-bottom: 5px; } div.withSidebar div#main { float: left; margin-left: 3%; width: 50%; } </style> <style> html, body { height: 100%; } * { font-size: 15pt; font-family: "Open Sans",sans-serif; color: rgba(0,0,0,0.70); } body { background: #f9f9f9; margin: 0px; padding: 0px; } h1, h2, h3, h4, h5, h6 { margin: 0px; padding: 0px; } .center { display: block; margin-left: auto; margin-right: auto; } /* * Various */ div.page { margin: 40px 25% 40px 25%; } ul.nostyle { list-style: none; } /* * links */ a { color: #00796B; text-decoration: none; font-weight: bold; } a:hover { color: #bf0a30; } /* * articles */ div.article { border-bottom: 1.5px solid rgba(0,0,0,0.54); padding-bottom: 2em !important; margin-bottom: 4em !important; } div.article p { text-align: justify; line-height: 1.5em; text-indent: 1em; margin-bottom: 0 !important; } div.article p:not(:first-child) { margin-top: 20px; } p.note { font-size: 12pt; color: rgba(0,0,0,0.54); text-indent: 0 !important; margin-top: 0 !important; } p.desc { line-height: 1.75em; } p.footer { font-size: 10pt; color: rgba(0,0,0,0.35); text-align: center; clear: both; /* ensure's it will be beneath any floating things */ } div.article pre { margin: 0; margin: 25px 2% 0px 2%; } /* * div.content styles */ h1, h2 { color: #bf0A30; } div.content h1 { font-size: 40pt; } div.content h2, div.content h2 * { font-size: 24pt; } div.content div.entry { margin-top: 2%; overflow-x: visible; clear: both; } div.content div.entry img { float: left; display: inline-block; width: 35%; max-height: 100px; margin: 25px; } </style> </head><body><nav><ul class="nav"><li><a href="https://www.addonovan.com"> addonovan</a> </li><li class="home"><a href="../index.html"> Projects</a> </li><li class="currentProject"><a href="#"> kftc</a> </li> </ul> </nav><div><div class="content page"><h1> OpModes </h1> </div><div class="withSidebar"><div id="sidebar"><h2> Contents </h2><ul><li><a href="index.html"> Home</a> </li><li><a href="getting-started.html"> Getting Started</a> </li><li><a href="opmodes.html"> OpModes</a><ul><li><a href="opmodes.html#lifecycle"> Lifecycle</a> </li><li><a href="opmodes.html#hardware"> Hardware</a> </li><li><a href="opmodes.html#configuration"> Configuration</a> </li> </ul> </li><li><a href="hardware-extensions.html"> Hardware Extensions</a> </li><li><a href="tasks.html"> Tasks</a> </li> </ul> </div><div class="content" id="main"><div class="article"><p> I've been using Java since I turned 13, so when I heard that FTC was moving to a Java/Android programming solution (instead of the god-awful RobotC/Mindstorms we'd been stuck with) for my last year on the team, I was ecstatic! However, this quickly changed when I realized that the OpMode SDK was &mdash; at least in my opinion &mdash; more of a mess than before! </p><p> My top three grievances with the OpMode SDK are listed below<ol><li> The OpMode lifecycle required delayed initialization </li><li> There was no recommended way to share hardware definitions<p class="note"> This was actually 'fixed' in v2.0 of the SDK; however, I'm still personally dissatisfied with their solution, as it's more of a disgusting hack (coming from me!) than something that they built in support for. </p> </li><li> There was still no way for configurable variables </li> </ol> And, oddly enough, if you look at the sidebar, you'll notice three sub-sections, which correspond to these. </p> </div><div class="article"><a name="lifecycle"></a><h2> The New Lifecycle </h2><p> The solution to this was redesigning the OpMode lifecycle in a way that wouldn't force declaration and initialization to occur at different places. This is more beneficial than simply allowing the variable's creation and assignment to happen in one place (which helps to make sure that the variable has been initialized <span class='wdmu italics'>before</span> it's run and a <span class='wdmu code'>NullPointerException</span> is thrown), but it also allows for the hardware devices to be marked as <span class='wdmu code'>val</span>s and ensure that their values will never be null nor will they be reassigned. </p><p> The moment any subclass of <span class='wdmu code'>KAbstractOpMode</span> is instantiated, it already possess a reference to the hardware map, controllers, and telemetry; the entire environment is completely initialized &mdash; ensured to be non-null. </p><pre>
<code class="kotlin">
@TeleOp( name = &quot;MyTeleOp&quot; )
class MyTeleOp : KOpMode()
{
    private val motorLeft: DcMotor = get( &quot;motor_left&quot; );

    public override fun loop()
    {
        motorLeft.power = 1.0;
    }
}
</code>
 </pre> </div><div class="article"><a name="hardware"></a><h2> Hardware Definitions </h2><p> While the above code snippet is valid, this is not the recommended route to go for hardware initialization. If you have used v2.+ of the standard sdk, then you will know that they encourage separating the hardware information from the OpMode class, and this is also encouraged in kftc; however, there is a little bit more of an API for it, rather than a completely detached class from the rest of the sdk. </p><p> In kftc, there is an abstract class called <span class='wdmu code'>HardwareDefinition</span>, which provides convenience access to the hardware map and an improved method to get HardwareExtensions as well. To access the hardware definition inside the OpMode, simply create a blank companion object which inherits from it. Now, anything defined in the hardware definition file can be referenced directly, as if it were defined in the same class. This is different than having a separate field (which must be initialized manually during <span class='wdmu code'>init()</span>) where the name of the field must be written prior to the hardware device. </p><pre>
<code class="kotlin">
abstract class MyHardwareDefinition : HardwareDefinition()
{
    val motorLeft: DcMotor = get( &quot;motor_left&quot; );
}

@TeleOp( name = &quot;My TeleOp&quot; )
class MyTeleOp : KOpMode()
{
    companion object : MyHardwareDefinition();

    override fun loop()
    {
        motorLeft.power = 1.0;
    }
}
</code>
 </pre> </div><div class="article"><a name="configuration"></a><h2> Configuration </h2><p> Perhaps the most important part of kftc is the configuration framework. It's super simple to implement in your KOpModes and easy to use. Now, maybe you can't think of any time that configurable variables might be useful, so here are a few examples<ul><li> A boolean indicating which alliance you're on </li><li> Sensor sensitivities </li><li> Autonomous motor powers<p class="note"> This is especially useful when debugging autonomous programs! </p> </li><li> Time delays for autonomous </li> </ul> </p><h3> Okay, so how do I implement them? </h3><pre>
<code class="kotlin">
class MyOpMode : KOpMode()
{
    // If there is no configured value for the given name
    //    then the second value (the default) is returned
    //    instead
    private val myBooleanValue = get( &quot;My Boolean Value's Name&quot;, false );
    private val myLongValue    = get( &quot;My Long Value's Name&quot;, 69L );
    private val myDoubleValue  = get( &quot;My Double Value's Name&quot, 4.20 );
    private val myStringValue  = get( &quot;My String Value's name&quot;, &quot;foobar&quot; );
}

// configuration method signatures for KOpMode & KLinearOpMode
get( name: String, default: Boolean ): Boolean
get( name: String, default: Long ): Long
get( name: String, default: Double ): Double
get( name: String, default: String ): String
</code>
 </pre><p> Only four types of variables can be configured: <span class='wdmu code'>boolean</span>s, <span class='wdmu code'>long</span>s, <span class='wdmu code'>double</span>s, and <span class='wdmu code'>String</span>s. And of course, these variables can be casted down to <span class='wdmu code'>int</span>s and <span class='wdmu code'>float</span>s, <span class='wdmu code'>long</span> and <span class='wdmu code'>double</span> were simply chosen as they are less restrictive. <span class='wdmu bold'>Any number of these variables can exist for any KOpMode</span> (or KLinearOpMode)! The only requirement for the variables is that they do not have conflicting names and types (i.e. you can't have a <span class='wdmu italics'>boolean</span> named &quot;Garrett&quot; and a <span class='wdmu italics'>string</span> named &quot;Garrett&quot;, as they are different types).<p class="note"> A great workaround for this is to use things that are roughly the synonyms, like &quot;My name is Hugh Mungus&quot; and &quot;Sexual Harassment&quot; </p> </p><h3> Great! Now how do I configure them? </h3><p> Of course, configurable variables would be utterly useless if you couldn't <span class='wdmu italics'>configure</span> them, so, naturally, there is a way to configure these variables. Now, the backend for this process is ugly (to say the least), but the front-end is very easy to use. In the top-right corner of the robot controller app's screen, there is a little robot icon, pay attention to this, as when it's blinking red, you can tap on it and open the OpMode and Profile Configuration tool. </p><img class="center" src="..//media/kftc/robot-icon.gif" alt="The blinking robot icon" style="border: 1px solid black;" height="75px"> </img><p> Once you've opened the configuration editor, the screens are fairly self-explanatory, but I should eventually get around to uploading screenshots for this. </p><p> Additionally, when you start to run an OpMode, the name of the active profile for the OpMode will be displayed in brackets after its name, so its immediately visible what profile is running so mistakes can be quickly corrected if the profile needs to be switched. </p> </div> </div> </div><div><p class="fglh footer"> Copyright &copy; 2016 Austin Donovan. All Rights Reserved. </p> </div> </div> </body></html>
