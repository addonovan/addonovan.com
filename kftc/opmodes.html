<!DOCTYPE html><html><head><meta charset="UTF-8"> </meta><title> OpModes | addonovan </title><meta name="viewport" content="width=device-width, initial-scale=1.0"> </meta><link rel="stylesheet" href="..//highlighting/idea.css"> </link> <script src="..//highlighting/highlight.js"></script> <style> nav { background-color: #00796B; padding-left: 5%; box-shadow: 0px 2px 5px rgba( 0, 0, 0, 0.2 ); height: 2em; z-index: 1; } nav> ul.nav { list-style: none; margin: 0; padding: 0; } nav> ul.nav> li { position: relative; display: inline; padding-top: 5px; padding-bottom: 5px; } nav> ul.nav> li.home { height: 1.7em; background: linear-gradient( 180deg, #171717, #2C2C2C, #171717 ); display: inline-block !important; padding-left: 20px; padding-right: 20px; box-shadow: 10px 0px 10px -10px rgba(0, 0, 0, 0.4), -10px 0px 10px -10px rgba(0, 0, 0, 0.4); margin-left: 1.75%; margin-right: 1.75%; } nav> ul.nav> li.home> a { color: #bf0a30; } nav> ul.nav> li.currentProject> a { color: white !important; } nav> ul.nav> li> a { text-decoration: none !important; font-size: 24px; color: rgba( 255, 255, 255, 0.87 ); transition: color 0.4s ease; font-weight: normal; } nav> ul.nav> li> a:hover { color: rgba( 255, 255, 255, 1.00 ); transition: color 0.2s ease; } @media only screen and ( max-width: 810px ) { ul.nav> li:not(.logo)> a { padding-left: 0.5%; padding-right: 0.5%; } nav { padding-left: 5%; white-space: nowrap; } } </style> <style> .wdmu.code { font-family: "Courier New", monospace !important; background-color: #dadada; color: #5a5a5a; } </style> <style> pre, pre *, pre code * { font-size: 11pt !important; font-family: "Courier", monospace !important; } </style> <style> div.withSidebar div#sidebar { float: left; margin-left: 7%; width: 15%; } div.withSidebar div#sidebar h2 { font-size: 24px; } div.withSidebar div#sidebar ul { padding-left: 15px; margin-top: 2px; } div.withSidebar div#sidebar ul li { list-style: none; margin-bottom: 2px; } div.withSidebar div#sidebar ul li ul { margin-left: 15px; margin-bottom: 5px; } div.withSidebar div#main { float: left; margin-left: 3%; width: 50%; } </style> <style> html, body { height: 100%; } * { font-size: 15pt; font-family: "Open Sans",sans-serif; color: rgba(0,0,0,0.70); } body { background: #f9f9f9; margin: 0px; padding: 0px; } h1, h2, h3, h4, h5, h6 { margin: 0px; padding: 0px; } /* * Various */ div.page { margin: 40px 25% 40px 25%; } ul.nostyle { list-style: none; } /* * paragraphs */ p { text-align: justify; line-height: 1.5em; text-indent: 25px; margin-top: 0; } p a { color: #00796B; text-decoration: none; font-weight: bold; } p a:hover { color: #bf0a30; } p.note { font-size: 12pt; color: rgba(0,0,0,0.54); } p.desc { line-height: 1.75em; } p.footer { font-size: 10pt; color: rgba(0,0,0,0.35); text-align: center; clear: both; /* ensure's it will be beneath any floating things */ } pre { margin: 0; } /* * div.content styles */ h1, h2 { color: #bf0A30; } div.content h1 { font-size: 40pt; } div.content h2, div.content h2 * { font-size: 24pt; } div.content div.entry { margin-top: 2%; overflow-x: visible; clear: both; } div.content div.entry img { float: left; display: inline-block; width: 35%; max-height: 100px; margin: 25px; } </style> </head><body><nav><ul class="nav"><li><a href="https://www.addonovan.com"> addonovan</a> </li><li class="home"><a href="../index.html"> Projects</a> </li><li class="currentProject"><a href="#"> kftc</a> </li> </ul> </nav><div><div class="content page"><h1> OpModes </h1> </div><div class="withSidebar"><div id="sidebar"><h2> Contents </h2><ul><li><a href="index.html"> Home</a> </li><li><a href="getting-started.html"> Getting Started</a> </li><li><a href="opmodes.html"> OpModes</a><ul><li><a href="opmodes.html#lifecycle"> Lifecycle</a> </li><li><a href="opmodes.html#hardware"> Hardware</a> </li> </ul> </li><li><a href="configuration.html"> Configuration</a> </li><li><a href="hardware-extensions.html"> Hardware Extensions</a> </li><li><a href="tasks.html"> Tasks</a> </li> </ul> </div><div class="content" id="main"><p> When I was a programmer on an FTC team, one of the bigger annoyances with FTC's sdk was the weird OpMode lifecycle. The annoying part was that the hardware map wasn't a static variable, which means that it was <code class='wdmu code'>null</code> until <code class='wdmu code'>init()</code> was called, forcing the delcaration and initialization of the fields to be separated, for no reason other than lack of foresight on the author's side. (This is to say, if the <code class='wdmu code'>hardwareMap</code> field were <code class='wdmu code'>static</code>, and set <i class='wdmu italics'>before</i> the OpModes are initialized, then the initialization could be done in one line). In kotlin, this forces the user to make <code class='wdmu code'>lateinit var</code>s instead of <code class='wdmu code'>val</code>s, when, really, hardware values should be forced to be constant just in case. </p><a name="lifecycle"></a><h2> The New Lifecycle </h2><p> The solution to this was redesigning the OpMode lifecycle in a way that wouldn't force declaration and initialization to occur at different places. This is more beneficial than simply allowing the variable's creation and assignment to happen in one place (which helps to make sure that the variable has been initialized <i class='wdmu italics'>before</i> it's run and a <code class='wdmu code'>NullPointerException</code> is thrown), but it also allows for the hardware devices to be marked as <code class='wdmu code'>val</code>s and ensure that their values will never be null nor will they be reassigned. </p><p> The moment any subclass of <code class='wdmu code'>KAbstractOpMode</code> is instantiated, it already possess a reference to the hardware map, controllers, and telemetry; the entire environment is completely initialized &mdash; ensured to be non-null. </p><pre>
<code class="kotlin">
@TeleOp( name = &quot;MyTeleOp&quot; )
class MyTeleOp : KOpMode()
{
    private val motorLeft: DcMotor = get( &quot;motor_left&quot; );

    public override fun loop()
    {
        motorLeft.power = 1.0;
    }
}
</code>
 </pre><a name="hardware"></a><h2> The Hardware Definition </h2><p> While the above code snippet is valid, this is not the recommended route to go for hardware initialization. If you have used v2.+ of the standard sdk, then you will know that they encourage separating the hardware information from the OpMode class, and this is also encouraged in kftc; however, there is a little bit more of an API for it, rather than a completely detached class from the rest of the sdk. </p><p> In kftc, there is an abstract class called <code class='wdmu code'>HardwareDefinition</code>, which provides convenience access to the hardware map and an improved method to get HardwareExtensions as well. To access the hardware definition inside the OpMode, simply create a blank companion object which inherits from it. Now, anything defined in the hardware definition file can be referenced directly, as if it were defined in the same class. This is different than having a separate field (which must be initialized manually during <code class='wdmu code'>init()</code>) where the name of the field must be written prior to the hardware device. </p><pre>
<code class="kotlin">
abstract class MyHardwareDefinition : HardwareDefinition()
{
    val motorLeft: DcMotor = get( &quot;motor_left&quot; );
}

@TeleOp( name = &quot;My TeleOp&quot; )
class MyTeleOp : KOpMode()
{
    companion object : MyHardwareDefinition();

    override fun loop()
    {
        motorLeft.power = 1.0;
    }
}
</code>
 </pre> </div> </div><div><p class="fglh footer"> Copyright &copy; 2016 Austin Donovan. All Rights Reserved. </p> </div> </div> </body></html>
